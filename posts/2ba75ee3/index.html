<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fuzz&quot;入门&quot; | 0xfocu5's blog</title><meta name="description" content="Fuzz——AFL学习记录。"><meta name="keywords" content="Fuzz,环境搭建"><meta name="author" content="燕乘风"><meta name="copyright" content="燕乘风"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="https://focu5.oss-accelerate.aliyuncs.com/blog/20200927102719.jpg"><link rel="canonical" href="https://0xfocu5.github.io/posts/2ba75ee3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Fuzz&quot;入门&quot;"><meta property="og:url" content="https://0xfocu5.github.io/posts/2ba75ee3/"><meta property="og:site_name" content="0xfocu5's blog"><meta property="og:description" content="Fuzz——AFL学习记录。"><meta property="og:image" content="https://focu5.oss-accelerate.aliyuncs.com/blog/20200927102719.jpg"><meta property="article:published_time" content="2020-08-02T16:00:00.000Z"><meta property="article:modified_time" content="2021-04-13T10:08:02.328Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Snackbar.bookmark.message_prev',
    message_next: 'Snackbar.bookmark.message_next'
  },
  runtime: 'days',
  date_suffix: {"one_hour":"date_suffix.one_hour","hours":"date_suffix.hours","day":"天前"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-04-13 18:08:02'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="https://focu5.oss-cn-beijing.aliyuncs.com/img/20200714224051.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">11</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">6</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tages</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Fuzz-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">Fuzz 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Fuzz-%E7%9A%84%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">Fuzz 的发展历程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pros-amp-Cons"><span class="toc-number">1.2.</span> <span class="toc-text">Pros &amp; Cons</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Anatomy-of-a-fuzzer"><span class="toc-number">1.3.</span> <span class="toc-text">Anatomy of a fuzzer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-should-I-fuzz-Finding-the-right-software"><span class="toc-number">1.4.</span> <span class="toc-text">What should I fuzz? Finding the right software</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AFL%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">AFL简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">工作流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fuzz%E7%9B%AE%E6%A0%87"><span class="toc-number">2.3.</span> <span class="toc-text">Fuzz目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%AF%AD%E6%96%99%E5%BA%93"><span class="toc-number">2.4.</span> <span class="toc-text">构建语料库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%96%99%E5%BA%93%E9%80%89%E6%8B%A9"><span class="toc-number">2.4.1.</span> <span class="toc-text">语料库选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E6%9D%A5%E6%BA%90"><span class="toc-number">2.4.2.</span> <span class="toc-text">主要来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%89%AA"><span class="toc-number">2.4.3.</span> <span class="toc-text">修剪</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AFL-CMIN"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">AFL-CMIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AFL-TMIN"><span class="toc-number">2.4.3.2.</span> <span class="toc-text">AFL-TMIN</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AFL%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">AFL实例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%A7%8BFuzz"><span class="toc-number">3.1.</span> <span class="toc-text">开始Fuzz</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E8%A7%A3%E8%AF%BB"><span class="toc-number">3.2.</span> <span class="toc-text">窗口解读</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90crash"><span class="toc-number">3.3.</span> <span class="toc-text">分析crash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%91%E7%9B%92%E6%B5%8B%E8%AF%95"><span class="toc-number">3.4.</span> <span class="toc-text">黑盒测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C"><span class="toc-number">3.5.</span> <span class="toc-text">输出结果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://focu5.oss-accelerate.aliyuncs.com/blog/20200927102719.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">0xfocu5's blog</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tages</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Fuzz&quot;入门&quot;</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-08-02T16:00:00.000Z" title="发表于 2020-08-03 00:00:00">2020-08-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-04-13T10:08:02.328Z" title="更新于 2021-04-13 18:08:02">2021-04-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Notes/">Notes</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Notes/Fuzz/">Fuzz</a></span></div><div class="meta-secondline"> </div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Fuzz-简介"><a href="#Fuzz-简介" class="headerlink" title="Fuzz 简介"></a>Fuzz 简介</h1><p><strong>模糊测试</strong> （fuzz testing, fuzzing）是一种<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95">软件测试</a>技术。其核心思想是将自动或半自动生成的随机数据输入到一个<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F">程序</a>中，并监视程序异常，如崩溃，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%96%B7%E8%A8%80_(%E7%A8%8B%E5%BC%8F)">断言</a>（assertion）失败，以发现可能的程序错误，比如内存泄漏。模糊测试常常用于检测软件或计算机系统的安全漏洞。</p>
<h2 id="Fuzz-的发展历程"><a href="#Fuzz-的发展历程" class="headerlink" title="Fuzz 的发展历程"></a>Fuzz 的发展历程</h2><ol>
<li><p>文件Fuzzing技术</p>
</li>
<li><p>语法模板Fuzzing</p>
</li>
<li><p>符号执行</p>
<p> 符号执行在学术界中应用得比较多，工业界相对少一些。在Fuzzing中，通过约束求解新路径的条件值，以增加代码覆盖率，可以一定程度上弥补暴力变异的不足。符号执行主要的挑战在于路径爆炸问题，约束求解能力的局限性，以及性能消耗问题，比如内存和时间消耗过大。</p>
</li>
<li><p>代码覆盖引导技术</p>
<p> 目前业界中基于代码覆盖率的最著名的三大Fuzzer，Google开发的<code>AFL</code>、<code>libfuzzer</code>和<code>honggfuzz</code>，且他们都是开源的，在github上都可以搜索到。</p>
</li>
</ol>
<h2 id="Pros-amp-Cons"><a href="#Pros-amp-Cons" class="headerlink" title="Pros &amp; Cons"></a>Pros &amp; Cons</h2><p>Fuzzing 是对于寻找漏洞是非常有效的，但其不是万能的，以下是它的一些优缺点。</p>
<p><strong>Pros</strong></p>
<ul>
<li>（不需要持续交互）Provides results with little effort - once a fuzzer’s up and running, it can be left for hours, days, or months to look for bugs with no interaction</li>
<li>Can reveal bugs missed in a manual audit</li>
<li>（检测程序整体的稳定性）Provides an overall picture of the robustness of the target software</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>（不能找到所有的漏洞）Won’t find all bugs - fuzzing may miss bugs that don’t trigger a full program crash, and may be less likely to trigger bugs that are only triggered in highly specific circumstances</li>
<li>（crash 样本比较难分析）The crashing test cases that are produced may be difficult to analyze, as the act of fuzzing doesn’t give you much knowledge of how the software operates internally</li>
<li>（对于复杂的程序效率会比较低）Programs with complex inputs can require much more work to produce a smart enough fuzzer to get sufficient code coverage</li>
</ul>
<h2 id="Anatomy-of-a-fuzzer"><a href="#Anatomy-of-a-fuzzer" class="headerlink" title="Anatomy of a fuzzer"></a>Anatomy of a fuzzer</h2><p>为了有效fuzz，fuzzer需要执行以下任务</p>
<ul>
<li>生成测试样本</li>
<li>记录测试用例的信息</li>
<li>把测试样例作为输入文件和目标程序（loader）进行对接</li>
<li>检测并监控 <code>crash</code></li>
</ul>
<p>其实上述所说的也就是一个 fuzzer 完整跑一遍的流程的简化。</p>
<h2 id="What-should-I-fuzz-Finding-the-right-software"><a href="#What-should-I-fuzz-Finding-the-right-software" class="headerlink" title="What should I fuzz? Finding the right software"></a>What should I fuzz? Finding the right software</h2><p>AFL在C或C ++应用程序上效果最好，因此，在 fuzz 之前一个”有效”的软件的攻击面是更为重要的。</p>
<ol>
<li>软件是否有示例代码？<ul>
<li>我们要 fuzz 的软件可能是很复杂很庞大的，如果其拥有大量的实例代码，那么我们快速定位到特定的模块，对每个模块单独 fuzz，这样测试的效果会更加优越。</li>
</ul>
</li>
<li>是否开源？<ul>
<li>对比开源项目来讲 afl 的效率会高很多，虽然 afl 也支持使用 qemu 进行黑盒 fuzz，但是效率会大打折扣。</li>
</ul>
</li>
<li>特殊样本是否容易收集？<ul>
<li>我们可能会要 fuzz 不同的文件格式，如果能够快速收集到大量有效的特殊的样本，那么 fuzz 的效率也会随之提高。</li>
</ul>
</li>
</ol>
<h1 id="AFL简介"><a href="#AFL简介" class="headerlink" title="AFL简介"></a>AFL简介</h1><p>AFL（American Fuzzy Lop）是由安全研究员Micha? Zalewski（<a target="_blank" rel="noopener" href="https://twitter.com/lcamtuf">@lcamtuf</a>）开发的一款基于覆盖引导（Coverage-guided）的模糊测试工具，它通过记录输入样本的代码覆盖率，从而调整输入样本以提高覆盖率，增加发现漏洞的概率。</p>
<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h2><ul>
<li>从源码编译程序时进行插桩，以记录代码覆盖率（Code Coverage）</li>
<li>选择一些输入文件，作为初始测试集加入输入队列（queue）</li>
<li>将队列中的文件按一定的策略进行”突变”</li>
<li>如果经过变异文件更新了覆盖范围，则将其保留添加到队列中</li>
<li>上述过程会一直循环进行，期间触发了crash的文件会被记录下来</li>
</ul>
<p><img src= "https://i.loli.net/2020/07/14/shCfncNLw9axrt8.gif" data-lazy-src="https://focu5.oss-accelerate.aliyuncs.com/blog/20200803080223.jpeg" alt="afl"></p>
<blockquote>
<p>程序插桩:<br>最早是由J.C. Huang 教授提出的，它是在保证被测程序原有逻辑完整性的基础上在程序中插入一些<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8E%A2%E9%92%88/1846154">探针</a>（又称为“探测仪”，本质上就是进行信息采集的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%BB%A3%E7%A0%81%E6%AE%B5/9966451">代码段</a>，可以是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%B5%8B%E5%80%BC%E8%AF%AD%E5%8F%A5/4248688">赋值语句</a>或采集覆盖信息的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8/4127405">函数调用</a>），通过<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8E%A2%E9%92%88/1846154">探针</a>的执行并抛出程序运行的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%89%B9%E5%BE%81/6205236">特征</a>数据，通过对这些数据的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%88%86%E6%9E%90/4327108">分析</a>，可以获得程序的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E6%B5%81/854473">控制流</a>和数据流信息，进而得到<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%80%BB%E8%BE%91%E8%A6%86%E7%9B%96/3231015">逻辑覆盖</a>等动态信息，从而实现测试目的的方法。</p>
<p>代码覆盖率：<br>软件测试中的一种度量，描述程式中源代码被测试的比例和程度，所得比例称为代码覆盖率。</p>
</blockquote>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><ul>
<li>直接安装：<code>sudo apt install afl</code></li>
<li><a target="_blank" rel="noopener" href="http://lcamtuf.coredump.cx/afl/">官网</a>下载压缩包，解压后在目录中打开终端输入：<code>sudo make;sudo make install</code></li>
</ul>
<blockquote>
<p>推荐自己编译安装，apt 安装不支持黑盒测试。</p>
</blockquote>
<h2 id="Fuzz目标"><a href="#Fuzz目标" class="headerlink" title="Fuzz目标"></a>Fuzz目标</h2><p><code>AFL</code>主要用于<code>C/C++</code>程序的测试，所以这是我们寻找软件的最优先规则。</p>
<p>目标开源与否不是很重要。</p>
<ul>
<li><p>对于开源软件：AFL软件进行编译的同时进行插桩，以方便fuzz（效率更高</p>
</li>
<li><p>对于闭源软件：配合QEMU直接对闭源的二进制代码进行fuzz</p>
</li>
</ul>
<h2 id="构建语料库"><a href="#构建语料库" class="headerlink" title="构建语料库"></a>构建语料库</h2><p>AFL需要一些初始输入数据（也叫种子文件）作为Fuzzing的起点，这些输入甚至可以是毫无意义的数据，AFL可以通过启发式算法自动确定文件格式结构。</p>
<p>尽管AFL如此强大，但如果要获得更快的Fuzzing速度，那么就有必要生成一个高质量的语料库（”有用的”输入的集合）</p>
<h3 id="语料库选择"><a href="#语料库选择" class="headerlink" title="语料库选择"></a>语料库选择</h3><ul>
<li>有效的输入：尽管有时候无效输入会产生bug和崩溃，但有效输入可以更快的找到更多执行路径。</li>
<li>尽量小的体积：种子文件最好小于 1KB，较小的文件会不仅可以减少测试和处理的时间，也能节约更多的内存。</li>
</ul>
<h3 id="主要来源"><a href="#主要来源" class="headerlink" title="主要来源"></a>主要来源</h3><ol>
<li><p>使用项目自身提供的测试用例</p>
</li>
<li><p>目标程序bug提交页面</p>
</li>
<li><p>使用格式转换器，用从现有的文件格式生成一些不容易找到的文件格式：</p>
</li>
<li><p>afl源码的testcases目录下提供了一些测试用例</p>
</li>
<li><p>其他大型的语料库</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://lcamtuf.coredump.cx/afl/demo/">afl generated image test sets</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/google/fuzzer-test-suite">fuzzer-test-suite</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://samples.libav.org/">libav samples</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://samples.ffmpeg.org/">ffmpeg samples</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/MozillaSecurity/fuzzdata">fuzzdata</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://gitlab.anu.edu.au/lunar/moonshine">moonshine</a></p>
</li>
</ul>
</li>
</ol>
<h3 id="修剪"><a href="#修剪" class="headerlink" title="修剪"></a>修剪</h3><p>网上找到的一些大型语料库中往往包含大量的文件，这时就需要对其精简，这个工作有个术语叫做——语料库蒸馏（Corpus Distillation）。AFL提供了两个工具来帮助我们完成这部工作——<code>afl-cmin</code>和<code>afl-tmin</code>。</p>
<h4 id="AFL-CMIN"><a href="#AFL-CMIN" class="headerlink" title="AFL-CMIN"></a>AFL-CMIN</h4><p><code>afl-cmin</code>的核心思想是：<strong>尝试找到与语料库全集具有相同覆盖范围的最小子集</strong>。举个例子：假设有多个文件，都覆盖了相同的代码，那么就丢掉多余的文件。其使用方法如下：</p>
<p><code>$ afl-cmin -i input_dir -o output_dir -- /path/to/tested/program [params]</code></p>
<p>更多的时候，我们需要从文件中获取输入，这时可以使用<code>@@</code>代替被测试程序命令行中输入文件名的位置。Fuzzer会将其替换为实际执行的文件：</p>
<p><code>$ afl-cmin -i input_dir -o output_dir -- /path/to/tested/program [params] @@</code></p>
<h4 id="AFL-TMIN"><a href="#AFL-TMIN" class="headerlink" title="AFL-TMIN"></a>AFL-TMIN</h4><p><code>afl-tmin</code>用来缩减文件体积。</p>
<p><code>afl-tmin</code>有两种工作模式，<code>instrumented mode</code>和<code>crash mode</code>。默认的工作方式是<code>instrumented mode</code>。</p>
<p>命令： <code>$ afl-tmin -i input_file -o output_file -- /path/to/tested/program [params] @@</code> </p>
<p>如果指定了参数<code>-x</code>，即<code>crash mode</code>，会把导致程序非正常退出的文件直接剔除。</p>
<p>命令：<code>$ afl-tmin -x -i input_file -o output_file -- /path/to/tested/program [params] @@</code></p>
<h1 id="AFL实例"><a href="#AFL实例" class="headerlink" title="AFL实例"></a>AFL实例</h1><h2 id="开始Fuzz"><a href="#开始Fuzz" class="headerlink" title="开始Fuzz"></a>开始Fuzz</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">vuln</span><span class="params">(<span class="keyword">char</span> *str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(str);</span><br><span class="line">    <span class="keyword">if</span>(str[<span class="number">0</span>] == <span class="string">&#x27;A&#x27;</span> &amp;&amp; len == <span class="number">66</span>) &#123;</span><br><span class="line">        raise(SIGSEGV); <span class="comment">//如果输入的字符串的首字符为A并且长度为66，则异常退出</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(str[<span class="number">0</span>] == <span class="string">&#x27;F&#x27;</span> &amp;&amp; len == <span class="number">6</span>) &#123;</span><br><span class="line">        raise(SIGSEGV);</span><br><span class="line">        <span class="comment">//如果输入的字符串的首字符为F并且长度为6，则异常退出</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;it is good!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    gets(buf);<span class="comment">//存在栈溢出漏洞</span></span><br><span class="line">    <span class="built_in">printf</span>(buf);<span class="comment">//存在格式化字符串漏洞</span></span><br><span class="line">    vuln(buf);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir fuzz_test; <span class="built_in">cd</span> fuzz_test </span><br><span class="line">$ mkdir fuzz_in fuzz_out</span><br><span class="line">$ afl-gcc -g -o afl_test afl_test.c //插桩编译</span><br><span class="line">$ sudo su</span><br><span class="line">$ <span class="built_in">echo</span> core &gt;/proc/sys/kernel/core_pattern</span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line">$ afl-fuzz -i fuzz_in -o fuzz_out ./afl_test</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ps：随便在 fuzz_in 放一些种子文件即可。</p>
<p>命令解析：</p>
<ul>
<li><p><code>-i</code>：指定测试样本的路径</p>
</li>
<li><p><code>-o</code>：指定输出结果的路径</p>
</li>
<li><p>更详细见：<code>$ afl-fuzz -h</code></p>
</li>
<li><p><code>echo core &gt;/proc/sys/kernel/core_pattern</code></p>
<p>  在执行<code>afl-fuzz</code>前，如果系统配置为将核心转储文件（core）通知发送到外部程序。 将导致将崩溃信息发送到Fuzzer之间的延迟增大，进而可能将崩溃被误报为超时，所以我们得临时修改<code>core_pattern</code>文件</p>
</li>
</ul>
</blockquote>
<p><img src= "https://i.loli.net/2020/07/14/shCfncNLw9axrt8.gif" data-lazy-src="https://focu5.oss-accelerate.aliyuncs.com/blog/20200803145522.png"></p>
<h2 id="窗口解读"><a href="#窗口解读" class="headerlink" title="窗口解读"></a>窗口解读</h2><ul>
<li><p>Process timing:Fuzzer运行时长、以及距离最近发现的路径、崩溃和挂起经过了多长时间。</p>
</li>
<li><p>Overall results：Fuzzer当前状态的概述。</p>
</li>
<li><p>Cycle progress：我们输入队列的距离。</p>
</li>
<li><p>Map coverage：目标二进制文件中的插桩代码所观察到覆盖范围的细节。</p>
</li>
<li><p>Stage progress：Fuzzer现在正在执行的文件变异策略、执行次数和执行速度。</p>
</li>
<li><p>Findings in depth：有关我们找到的执行路径，异常和挂起数量的信息。</p>
</li>
<li><p>Fuzzing strategy yields：关于突变策略产生的最新行为和结果的详细信息。</p>
</li>
<li><p>Path geometry：有关Fuzzer找到的执行路径的信息。</p>
</li>
<li><p>CPU load：CPU利用率</p>
</li>
</ul>
<h2 id="分析crash"><a href="#分析crash" class="headerlink" title="分析crash"></a>分析crash</h2><p>因为程序本身很简单，跑了几分钟跑出来 4 个<code>crash</code></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ xxd id:000004,sig:06,src:000000,op:havoc,rep:64</span><br><span class="line"></span><br><span class="line">00000000: 4100 7f00 00f1 83ec ff00 7f00 00f1 7fff  A...............</span><br><span class="line">00000010: ffff 0c41 007f 0000 f1a2 ffff ff0b fd5f  ...A..........._</span><br><span class="line">00000020: 8000 0000 fe0c 5f6b 2000 ff0c 6200 7f0c  ......_k ...b...</span><br><span class="line">00000030: 5f6b 00f1 7fec ff00 7f00 00f1 7fff ffff  _k..............</span><br><span class="line">00000040: 0c41 007f 0000 f1a2 ffff ff0b fd5f 8000  .A..........._..</span><br><span class="line">00000050: 0000 fe0c 5f6b 2000 ff0c 6200 7f0c 5f6b  ...._k ...b..._k</span><br><span class="line">00000060: 0000 00fe 8108 7f00 0000 00fe 405f 6b00  ............@_k.</span><br><span class="line">00000070: 00ff 0000 f17f ecff 007f 0000 f17f ffff  ................</span><br><span class="line">00000080: ff0c 4100 7f00 00f1 a2ff ffff 0bfd 5f80  ..A..........._.</span><br><span class="line">00000090: 0000 00fe 0c5f 6b20 0000 00fe 7e0c 4100  ....._k ....~.A.</span><br><span class="line">000000a0: 7f00 00f1 7fff ffff 0bec 5f80 0000 00fe  .........._.....</span><br><span class="line">000000b0: 0c5f 6700 0000 fe7e 0800 0000 fe81 087f  ._g....~........</span><br><span class="line">000000c0: 0000 0000 fe40 5f6b 0000 00ff 4100 7f00  .....@_k....A...</span><br><span class="line">000000d0: 00f1 a2ff ffff 0bfd 5f80 0000 00fe 0c5f  ........_......_</span><br><span class="line">000000e0: 6b20 00ff 0c62 007f 0c5f 6b00 0000 fe72  k ...b..._k....r</span><br><span class="line">000000f0: 087f 0000 0000 fe40 5f6b 0000 ff0c 4100  .......@_k....A.</span><br><span class="line">00000100: 7f00 00f1 7fff ffff 0bec 5f80 0000 00fe  .........._.....</span><br><span class="line">00000110: 0c5f 6700 0000 fe7e 0c41 007f 0000 f17f  ._g....~.A......</span><br><span class="line">00000120: ffff ff0b ec5f 8000 0000 fe0c 5f67 0000  ....._......_g..</span><br><span class="line">00000130: 00fe 7e08                                ..~.</span><br></pre></td></tr></table></figure>

<p>可以看出来是由栈溢出所导致的。</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ xxd id:000002,sig:06,src:000000,op:havoc,rep:128</span><br><span class="line">00000000: 256e                                     %n</span><br></pre></td></tr></table></figure>

<p>格式化字符串导致。</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxd id:000000,sig:11,src:000001,op:havoc,rep:4</span><br><span class="line">00000000: 4672 6497 7364                           Frd.sd</span><br></pre></td></tr></table></figure>

<p>输入的字符串的首字符为F并且长度为6，则异常退出</p>
<h2 id="黑盒测试"><a href="#黑盒测试" class="headerlink" title="黑盒测试"></a>黑盒测试</h2><p>黑盒测试要用到AFL的QEMU模式了。</p>
<p>所以我们需要再额外装一下东西。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~</span><br><span class="line">$ sudo apt-get install libini-config-dev libtool-bin automake bison libglib2.0-dev -y</span><br><span class="line">$ <span class="built_in">cd</span> afl-2.52/qemu_mode</span><br><span class="line">$ ./build_qemu_support.sh</span><br><span class="line">$ <span class="built_in">cd</span> .. </span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure>

<p>我们接着用刚刚的源文件重新编译然后进行新的黑盒 fuzz。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -g -o afl_test2 afl_test.c</span><br><span class="line">$ afl-fuzz -i fuzz_in -o fuzz_out -Q ./afl_test2</span><br></pre></td></tr></table></figure>

<p><img src= "https://i.loli.net/2020/07/14/shCfncNLw9axrt8.gif" data-lazy-src="https://focu5.oss-accelerate.aliyuncs.com/blog/20200804111331.png" alt="image"></p>
<h2 id="输出结果"><a href="#输出结果" class="headerlink" title="输出结果"></a>输出结果</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fuzz_out/</span><br><span class="line">├── crashes</span><br><span class="line">│   ├── id:000000,sig:06,src:000000,op:havoc,rep:32</span><br><span class="line">│   ├── id:000001,sig:06,src:000000,op:havoc,rep:32</span><br><span class="line">│   ├── id:000002,sig:11,src:000001,op:havoc,rep:2</span><br><span class="line">│   ├── id:000003,sig:06,src:000002,op:havoc,rep:16</span><br><span class="line">│   ├── id:000004,sig:11,src:000000,op:havoc,rep:128</span><br><span class="line">│   ├── id:000005,sig:11,src:000002,op:havoc,rep:16</span><br><span class="line">│   └── README.txt</span><br><span class="line">├── fuzz_bitmap</span><br><span class="line">├── fuzzer_stats</span><br><span class="line">├── hangs</span><br><span class="line">├── plot_data</span><br><span class="line">└── queue</span><br><span class="line">    ├── id:000000,orig:test</span><br><span class="line">    ├── id:000001,src:000000,op:arith8,pos:0,val:-30,+cov</span><br><span class="line">    └── id:000002,src:000000,op:arith8,pos:0,val:-35,+cov</span><br><span class="line"></span><br><span class="line">3 directories, 13 files</span><br></pre></td></tr></table></figure>

<p><code>queue</code>：存放所有具有独特执行路径的测试用例。<br><code>crashes</code>：导致目标接收致命<code>signal</code>而崩溃的独特测试用例。<br><code>crashes/README.txt</code>：保存了目标执行这些<code>crash</code>文件的命令行参数。<br><code>hangs</code>：导致目标超时的独特测试用例。<br><code>fuzzer_stats</code>：<code>afl-fuzz</code>的运行状态。<br><code>plot_data</code>：用于<code>afl-plot</code>绘图。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95">https://zh.wikipedia.org/wiki/%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95</a></p>
<p><a target="_blank" rel="noopener" href="https://www.f-secure.com/en/consulting/our-thinking/15-minute-guide-to-fuzzing">https://www.f-secure.com/en/consulting/our-thinking/15-minute-guide-to-fuzzing</a></p>
<p><a target="_blank" rel="noopener" href="https://foxglovesecurity.com/2016/03/15/fuzzing-workflows-a-fuzz-job-from-start-to-finish/">https://foxglovesecurity.com/2016/03/15/fuzzing-workflows-a-fuzz-job-from-start-to-finish/</a></p>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/841/#2_3">https://paper.seebug.org/841/#2_3</a></p>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/842/#_1">https://paper.seebug.org/842/#_1</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4314#toc-8">https://xz.aliyun.com/t/4314#toc-8</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">燕乘风</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://0xfocu5.github.io/posts/2ba75ee3/">https://0xfocu5.github.io/posts/2ba75ee3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://0xfocu5.github.io" target="_blank">0xfocu5's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Fuzz/">Fuzz</a><a class="post-meta__tags" href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建</a></div><div class="post_share"><div class="social-share" data-image="https://focu5.oss-accelerate.aliyuncs.com/blog/20200927102719.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/7eb4a1e6/"><img class="prev-cover" data-lazy-src="https://focu5.oss-accelerate.aliyuncs.com/blog/20200927102719.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">2019-StarCtf-oob</div></div></a></div><div class="next-post pull-right"><a href="/posts/ab6e7b0/"><img class="next-cover" data-lazy-src="https://focu5.oss-accelerate.aliyuncs.com/blog/20200802074734.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">CSAPP Lab</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 燕乘风</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    window.valine = new Valine({
      el: '#vcomment',
      appId: 'P9GVfs1MeERE7LeK2DFsJXmn-gzGzoHsz',
      appKey: 'hzbjuPyWPjwk5HpiLPf3csE9',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    });
    if ('nick,mail') { valine.config.requiredFields= 'nick,mail'.split(',') }
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/js/focu5.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="100" mobile="true" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/click_heart.js" async="async"></script></div></body></html>